import cv2
import numpy as np

eye_gap_distance = 60.0  
lens_focus_value = 640.0 
aim_box_size = 50 

left_eye_camera = cv2.VideoCapture(0)
right_eye_camera = cv2.VideoCapture(1)

def find_distance_to_target(horizontal_shift):
    if horizontal_shift == 0: 
        return 0
    return (lens_focus_value * eye_gap_distance) / horizontal_shift

while True:
    view_ok_left, image_left = left_eye_camera.read()
    view_ok_right, image_right = right_eye_camera.read()
    
    if not view_ok_left or not view_ok_right: 
        break

    height, width = image_left.shape[:2]
    center_x, center_y = width // 2, height // 2
    
    left_gray = cv2.cvtColor(image_left, cv2.COLOR_BGR2GRAY)
    right_gray = cv2.cvtColor(image_right, cv2.COLOR_BGR2GRAY)

    cv2.rectangle(image_left, 
                  (center_x - aim_box_size, center_y - aim_box_size),
                  (center_x + aim_box_size, center_y + aim_box_size), 
                  (0, 255, 0), 2)

    target_sample = left_gray[center_y-10:center_y+10, center_x-10:center_x+10]
    right_search_row = right_gray[center_y-10:center_y+10, 0:width]
    
    match_score = cv2.matchTemplate(right_search_row, target_sample, cv2.TM_CCOEFF_NORMED)
    _, _, _, location_of_match = cv2.minMaxLoc(match_score)
    
    matched_x_position = location_of_match[0] + 10 
    pixel_shift = abs(center_x - matched_x_position)
    
    distance_in_centimeters = find_distance_to_target(pixel_shift) / 10

    if distance_in_centimeters > 0:
        result_text = f"Distance: {distance_in_centimeters:.1f} cm"
    else:
        result_text = "Scanning..."

    cv2.putText(image_left, result_text, (center_x - 60, center_y - 70), 
                cv2.FONT_HERSHEY_SIMPLEX, 0.7, (0, 255, 0), 2)
    
    cv2.imshow("Aura Guide - Vision HUD", image_left)

    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

left_eye_camera.release()
right_eye_camera.release()
cv2.destroyAllWindows()